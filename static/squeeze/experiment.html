<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://vjs.zencdn.net/8.22.0/video-js.css" rel="stylesheet" />
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f6f8;
            color: #333;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .content-wrapper {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 700px;
            width: 100%;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        p {
            line-height: 1.6;
            margin-bottom: 15px;
            text-align: left;
        }
        .back-button {
            background-color: #7f8c8d; /* Grey for back button */
            color: white;
            border: none;
            padding: 15px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 18px;
            margin-top: 20px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .back-button:hover {
            background-color: #6c7a7d;
        }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <h1>Squeeze Experiment Page</h1>
        <p>Experiment content will go here.</p>

        <video
            id="my-video"
            class="video-js"
            controls
            preload="auto"
            width="640"
            height="360"
            autoplay
            muted
            data-setup='{"autoplay": true, "muted": true}'
        >
            <source src="https://cdn.jsdelivr.net/gh/loftusmi3/byb-squeeze-videos@8717b6ab917974cddfb96d9311f4b83b68a36578/hard1.mp4" type="video/mp4" />
            <p class="vjs-no-js">
                To view this video please enable JavaScript, and consider upgrading to a
                web browser that
                <a href="https://videojs.com/html5-video-support/" target="_blank"
                    >supports HTML5 video</a
                >
            </p>
        </video>

        <button id="backButton" class="back-button">Back to Home</button>
    </div>

    <script src="https://vjs.zencdn.net/8.22.0/video.min.js"></script>
    <script>
        document.getElementById('backButton').addEventListener('click', () => {
            window.location.href = './index.html'; // Navigate back to the landing page
        });

        var player = videojs('my-video');
        const videoBaseUrl = "https://cdn.jsdelivr.net/gh/loftusmi3/byb-squeeze-videos@8717b6ab917974cddfb96d9311f4b83b68a36578/";
        const videoIds = ["hard1", "hard2", "hard3", "hard4"];
        let currentVideoIndex = 0;
        let isSwitching = false; // Flag to prevent multiple switches during one 4s interval

        function initiateVideoLoad(videoIdx) {
            if (videoIdx >= videoIds.length) {
                console.log("All video segments played.");
                player.off('timeupdate', timeUpdateHandler); // Stop listening to timeupdate
                return;
            }
            
            console.log(`Attempting to load video index: ${videoIdx}, ID: ${videoIds[videoIdx]}`);
            const nextVideoSrc = videoBaseUrl + videoIds[videoIdx] + ".mp4";
            player.src({ type: 'video/mp4', src: nextVideoSrc });
            player.load();
        }

        // This handler will be attached and detached as needed
        function timeUpdateHandler() {
            if (!isSwitching && player.currentTime() >= 4) {
                // Ensure currentVideoIndex is valid before logging with it
                if (currentVideoIndex < videoIds.length) {
                    console.log(`Video ${videoIds[currentVideoIndex]} reached 4s. Current time: ${player.currentTime()}. Attempting to switch.`);
                } else {
                    console.log(`Current video (index ${currentVideoIndex-1}) reached 4s. No more videos to switch to, or already switched.`);
                }
                
                isSwitching = true; // Prevent re-entry while switching
                currentVideoIndex++; // Move to the next video index
                initiateVideoLoad(currentVideoIndex);
            }
        }

        player.on('loadedmetadata', function() {
            // Ensure currentVideoIndex is valid for videoIds array before logging
            if (currentVideoIndex < videoIds.length) {
                 console.log(`Metadata loaded for video: ${videoIds[currentVideoIndex]}. Playing.`);
            } else {
                 // This case might happen if 'loadedmetadata' fires after the last video was initiated and currentVideoIndex is now out of bounds for videoIds
                 console.log(`Metadata loaded for a video, currentVideoIndex is ${currentVideoIndex}. This might be the last video.`);
            }
            player.play().catch(e => console.error("Play interrupted or failed:", e));
            isSwitching = false; // Reset flag: video is loaded and playing, ready for its 4s countdown
        });
        
        player.on('error', function() {
            console.error("Video player error:", player.error());
            if (!isSwitching) { 
                isSwitching = true; 
                console.log("Attempting to load next video due to error.");
                currentVideoIndex++;
                initiateVideoLoad(currentVideoIndex);
            }
        });

        // Start
        player.ready(function() {
            console.log("Player ready. Attaching timeupdate listener and initiating first video.");
            player.on('timeupdate', timeUpdateHandler); // Attach timeupdate listener
            initiateVideoLoad(currentVideoIndex); // Load the first video (index 0)
        });

    </script>
</body>
</html> 